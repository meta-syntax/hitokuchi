# ファイル配置に迷った場合のルール

**ステータス:** 採用

**日付:** 2026-02-22

---

## コンテキスト

Next.js App Routerのディレクトリ設計において、Colocation（`app/ルート/_components/`等）とグローバル配置（`src/components/`等）の判断に迷う場面が頻繁に発生する。どちらにもトレードオフがあり、完璧な基準は存在しない。チームメンバーの設計経験にも差がある中で、判断のブレを最小化するデフォルトルールが必要。

## 検討した選択肢

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| A: 迷ったらグローバル | 同一ロジックの重複を防げる | 使われていないファイルがグローバルに溜まりやすい |
| B: 迷ったらColocation | ルート削除時にファイルも消えるので不要ファイルが残りにくい | 似たコードが複数ルートに分散し、重複に気づきにくい |

## 決定

**選択肢A: 迷ったらグローバルに置く。**

確実にそのルートでしか使わないと言い切れるものだけColocationする。

## 根拠

- コードの重複はコードベースへのダメージが大きい。修正漏れやバグの温床になる
- 不要ファイルの蓄積はIDEのFind Usagesやlintで検知・対処できるが、複数ルートにまたがる重複の発見は難しい
- ファイルの移動（グローバル↔Colocation）はIDEのリファクタリング機能で低コストに実行できるため、後から配置を変えることへの障壁は低い
- 判断に迷う状態は「共有される可能性が排除しきれていない」ことを意味するため、重複リスクの低いグローバル側に倒す方が安全

## 補足

このルールは100点の構造を目指すものではなく、チーム全員が一貫して守れる70点の構造を維持するためのものである。完璧なディレクトリ設計は存在しないので、迷ったときの行動を統一することで判断コストを下げ、一貫性を保つことを優先する。
