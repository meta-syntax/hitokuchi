# グローバルディレクトリの責務分離

**ステータス:** 採用

**日付:** 2026-02-22

---

## コンテキスト

Next.js App Routerではサーバーとクライアントの境界が明確に分かれる。グローバルディレクトリ（`hooks/`, `lib/`, `services/`
）の責務を曖昧にすると、サーバー専用コードがクライアントに漏れたり、逆にクライアント専用のフックをServer
Componentから呼び出してランタイムエラーになるリスクがある。

また、バリデーションや表示変換などドメイン依存かつ環境非依存のロジック（サーバー・クライアント両方で使いたい関数）の置き場所が不明確だった。

## 検討した選択肢

| 選択肢                             | メリット                             | デメリット                                          |
|---------------------------------|----------------------------------|------------------------------------------------|
| A: `hooks/`にサーバー・クライアントを共存させる   | ディレクトリが増えない                      | ファイルを開かないと環境が分からない。`"use client"`の有無が混在して紛らわしい |
| B: `lib/`の定義を「環境非依存の共有ロジック」に広げる | ディレクトリを増やさず対応できる。ファイル名でドメインが判別可能 | `lib/`の対応範囲が広くなる                               |
| C: `domain/`や`shared/`を新設する     | 分離が明確                            | ディレクトリが増える。`lib/`との境界が曖昧になる                    |

## 決定

**選択肢B: `lib/`を「環境非依存の共有ロジック」として、ドメイン依存のコードも置く。**

各ディレクトリの責務を実行環境で分離する。

| ディレクトリ      | 実行環境     | 責務                  | 強制手段                   |
|-------------|----------|---------------------|------------------------|
| `hooks/`    | クライアントのみ | UIの状態管理・ブラウザAPI利用   | `"use client"` を必ず付与   |
| `lib/`      | 環境非依存    | ユーティリティ・定数・ドメインロジック | なし（どこからでもimport可能）     |
| `services/` | サーバーのみ   | DB・外部APIアクセス        | `import 'server-only'` |

## 根拠

- `hooks/`に`"use client"`ありとなしが混在すると、フックなのかただの関数なのか曖昧になる
- ドメイン依存の共有ロジック（バリデーション、表示変換等）はファイル名にドメイン名が入るため、`lib/utils.ts`
  等の汎用ファイルとは自然に区別できる
- 現時点のファイル数ではサブディレクトリ分離は過剰。増えてきたら再検討する
